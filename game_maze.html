<!DOCTYPE html PUBLIC"-//W3C//DTD XHTML 1.0 Transitional//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>
		ROGUELIKE DUNGEON GAME
	</title>
	<style type="text/css">
		canvas{
			background-color: #F1F1F1;
			border:1px solid #D3D3D3;
		}
	</style>
</head>
<body onload="startGame()">
<script type="text/javascript">
var myGameArea;
var obstacles;
var i;
var img,imgData;
var door;
var time;
var num=120;
var s=50;
function startGame()
	{
		myGameArea.start();
	}
	myGameArea=
	{
		canvas:document.createElement("canvas"),
		start:function()
		{
			this.canvas.width=1000;
			this.canvas.height=661;
			this.context=this.canvas.getContext("2d");
			img=new Image();
         	img.src="dungeon_1.jpg";
           	myGamePiece=new component(this.context,30,30,"pacman_stop.jpg",78,550,"image");
            door=new component(this.context,50,50,"door.jpg",855,60,"image");
            time=new component(this.context,"20px","consolas","red",750,50,"text");
			document.body.insertBefore(this.canvas,document.body.childNodes[0]);
			this.interval=setInterval(updateGameArea,20);
		setTimeout(function(){clearInterval(this.interval);alert("Game over!");document.location.reload();},120000);
			window.addEventListener("keydown",function(e)
			{
				myGameArea.key=e.keyCode;
			})
			window.addEventListener("keyup",function(e)
			{
				myGamePiece.image.src="pacman_stop.jpg";
				myGameArea.key=false;

			})
		},
		clear:function()
		{
			this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
			this.context.drawImage(img,0,0);
		},
		stop:function()
		{
			clearInterval(this.interval);
		}
	}
	function component(context,width,height,image,x,y,type)
	{
		this.type=type;
		this.width=width;
		this.height=height;
		this.image=image;
		this.speedX=0;
	this.speedY=0;
	if(this.type=="image")
		{
		this.image=new Image();
		this.image.src=image;
	}
		this.x=x;
		this.y=y;
		this.update=function()
		{
	if(this.type=="image")
			{
			ctx=context;
            ctx.drawImage(this.image,this.x,this.y,this.width,this.height);
        }
        else
        {
        	ctx=context;
    	ctx.font="20px consolas";
    	ctx.fillStyle="red";
    	ctx.fillText(this.text,this.x,this.y);
    	s=s-1;
    	if(s==0)
    		{s=50;
    		num=num-1;
    	}
        }
		}
		this.newpos=function()
		{
			this.x+=this.speedX;
			this.y+=this.speedY;
		}
	this.color=function()
		{
          imgData=ctx.getImageData(this.x,this.y,1,1).data;//returning color of current point 
          return imgData;
          		}
		this.crashWith=function()
		{
            if(this.color=="0,0,0,255")//if this.color is checked for not being equal to black the gamepiece does not move at all
            	return true;
		}
		this.crashWithDoor=function(otherobj)
		{
			var myLeft=this.x;
			var myRight=this.x+this.width;
			var myTop=this.y;
			var myBottom=this.y+this.height;
			var otherLeft=otherobj.x;
			var otherRight=otherobj.x+otherobj.width;
			var otherTop=otherobj.y;
			var otherBottom=otherobj.y+otherobj.height;
			var crash =true;
			if((myLeft>otherRight)||(myRight<otherLeft)||(myTop>otherBottom)||(myBottom<otherTop))
				crash=false;
			return crash;
		}
	}
	function updateGameArea()
	{
	 myGameArea.clear();
		myGamePiece.speedX=0;
		myGamePiece.speedY=0;
		if(myGamePiece.crashWithDoor(door))
		{
			alert("CONGRATULATIONS!!! Level 1 cleared!!!");
			document.location.reload();
		}
		if(myGameArea.key&&myGameArea.key==38)
		{
			myGamePiece.image.src="pacman_up.jpg";
			myGamePiece.speedY=-1;
			myGamePiece.speedX=0;
		if(myGamePiece.crashWith())//checking for collision
			{
				myGamePiece.image.src="pacman_stop.jpg";
				myGamePiece.speedY+=1;
				myGamePiece.speedX=0;
			}
		}
		if(myGameArea.key&&myGameArea.key==37)
		{
			myGamePiece.image.src="pacman_left.png";
			myGamePiece.speedX=-1;
			myGamePiece.speedY=0;
			if(myGamePiece.crashWith())//checking for collision
			{
				myGamePiece.image.src="pacman_stop.jpg";
				myGamePiece.speedX+=1;
				myGamePiece.speedY=0;
			}
		}
		if(myGameArea.key&&myGameArea.key==39)
		{
			myGamePiece.image.src="pacman_right.jpg";
			myGamePiece.speedX=1;
			myGamePiece.speedY=0;
			if(myGamePiece.crashWith())//checking for collision
			{
				myGamePiece.image.src="pacman_stop.jpg";
				myGamePiece.speedX-=1;
				myGamePiece.speedY=0;
			}
		}
		if(myGameArea.key&&myGameArea.key==40)
		{
			myGamePiece.image.src="pacman_down.png";
			myGamePiece.speedY=1;
			myGamePiece.speedX=0;
			if(myGamePiece.crashWith())//checking for collision
			{
				myGamePiece.image.src="pacman_stop.jpg";
				myGamePiece.speedY-=1;
				myGamePiece.speedX=0;
			}
		}
     myGamePiece.newpos();
     myGamePiece.update();
     door.update();
    time.text="Time left-"+num+"seconds";
     time.update(); 
	}
</script>
</body>
</html>